> 本章节内容主要介绍YIQI-EVB-01开发板

# 开发板原理图
## 供电和充电电路
### 供电
- 本开发板采用MicroUSB作为电源输入，5V，通用且可靠；
- MicroUSB还作为USB-to-TTL串口通信；
- 采用3组电容为电源滤波和储能；
- 使用PAM3101将5V输入降压为3.3V为单片机及其外设提供电源，此IC是低压差型最大300mA电流，满足单片机的基本需求；
- 总电源开关由自锁开关控制；

### 充电
- 采用TP4056作为锂电池充电IC，具有可变充电电流模式，只需调整PROG电阻值接口实现对多种型号锂电池充电；
- 开发板标配3.7-4.2V锂电池采用850mA大电流放电功能，默认充电电流为300mA，2-3小时将电池充满，稳定可靠，且对电寿命有保障；
- 具备两个LED指示灯，红色作为充电中接在CHRG口，绿色作为充满接在STDBY口。实际应用中也可以将CHRG和STDBY接入单片机IO口，采用中断接收方式通知单片机电池充放状态；
- VBAT作为锂电池的输入输出，通过电阻分压后接入单片机PA0口，实现了对电池电压的ADC采集，充满为4.2V左右，欠压到3.3V左右时应该通知用户对电池充电，否则电池过度放电对整体使用寿命有影响；

## 单片机最小系统
- 采用STM32L152CBT6-A型号低功耗单片机，LQFP48封装便于维护和焊接；
- 单片机所有的IO口都做了解释说明，每个IO口的复用功能都在图中标明，便于查找合适的IO类型进行开发；
- 电路中有两个晶振，X2 8MHz晶振是倍频作用可以使得单片机工作在所需的某种主频下，X3 32.768K晶振是RTC时钟参考作用为单片机提供精准的时间；
- SWD刷机口作为开发过程中使用频率最高的接口，引出4个IO；

## 单片机外围用户接口
### 标准IO
- 开发板引出几路通用IO，有Reset复位按键；
- 用户LED两路D4和D5，红色和绿色；
- 用户按键PA8，作为输入使用；
- 蜂鸣器PB4作为提醒用户使用；
- 1路SPI1 J4给nRF4L01 Sub-1G模块使用，也可以单独作为；
- 1路IO PB1给DS18B20温度传感器单总线使用；
- 1路串口USART2给ESP6288 WiFi 和 BC95 NB-IoT模组复合使用；
- 2路IO(PA11、PA15或PA12、PB3)给HX711压力传感器使用；
- 1路串口USART1接USB-to-TTL使用，用于程序开发时的调试打印；

### 扩展IO
- 1路SPI2和4路ADC输入 P8作为扩展口；
- 1路串口USART3和1路IIC2 P7作为扩展口；
- J4 nRF24L01插座可单独作为扩展口；
- HX711其中一组或两组组可以单独作为扩展口；

## 通讯模组
### NB-IoT
- 模组由锂电池直接供电；
- BC95 NB-IoT模组使用USART2与单片机通讯；
- 有一个总电源插座BC95 PWR；
- 1路通讯连接单片机P3，红色座子接单片机，黄色座子与模组连线，可以在线实时监控单片机与模组之间的通讯过程；
- 将红色跳帽拔掉，外置串口线接黄色座子，可以单独调试模组；
- 1路模组debug接口用户调试模组时使用，这属于高级特性一般情况不使用；
- 模组15口与单片机PB5相连，可以通过单片机高低电平复位模组；


### WiFi
- ESP8266模组由PAM3101供电；
- ESP8266 WiFi模组使用USART2与单片机通讯，与BC95同时只能使用一个；
- 提供模组下载软件接口J3，下载完成后需要置空；
- 模组1口与单片机PA15连接，用于复位；

### Sub-1G
- nRF24L01是直插式，天线朝向开发板外部插入；

## 传感器
### 温度DS18B20
- 本传感器采用单总线（One Wire）连接方式，使用时序进行数据采集；
- 传感器是防水设计，可用于空气、液体和土壤中；
- 采用XH2.54排座排针连接；

### 压力HX711
- 本传感器采用双线制，使用控制线和数据线；
- 传感器采用一体化设计，直接可以放置物品称量压力，并转换为重量；

# PCB 布局
## 整体布局
本开发板整体布局较为紧凑，按理说开发板应该做的宽松和相对密度小一些，而本开发板在布局上参考了实际项目中的产品设计布局而特意做成高密度型，这样便于读者参考，应用在实际项目中以减少PCB面积。
- 本开发板是双层PCB板，元器件大部分是在表面布局，读者在实际产品应用过程中可以做成双面焊接以节省PCB大小。模组和其他外设可以摆放背面，既美观又节约空间；
- 开发板采用了0805封装的电阻电容焊盘，一方面是方便查看元器件的型号，另一方面是便于维修和看清整体布局。读者在实际应用过程中，可以替换成0603或0402更小一些的封装；
- 为了方便安装和替换锂电池，本开发板使用了5号锂电池和板载焊接底座作为供电方式，占用了不少PCB面积。读者在实际应用过程中，可以做成XH2.54焊盘，采用扁平的锂电池节省PCB空间，减少产品的物理高度；
- 本开发板NB模组射频采用板载PCB式天线，读者可以参考此天线设计做在实际产品中，一方面是减少安装外置天线的步骤，另一方面是没有外置天线占用物理空间。当然，读者也可以将PCB天线连接的电阻断开，焊接外置增益天线；
- WiFi和Sub-1G模组都是采用了模组自带射频天线的版本，实际应用过程中可以选用外置增益天线的模组；
- 为了便于测试和调试应用程序，板载做了很多电源跳线帽，实际应用中可以采用0欧电阻或直接焊接上；
- 本开发板将扩展IO都延伸到板子边缘，美观且方便接线，但是，实际应用过程中不建议这么做，应该尽量将外设传感器靠近MCU焊接，减少信号损失；
- 为了便于测试和观察，板载做了好多LED指示灯，对于低功耗产品尽量减少外部非必需的外设，尤其是长期耗电元件；
- 为了方便安装PCB固定在外壳或容器中，建议在PCB边缘或角落放置螺丝孔，如螺丝是3mm粗建议将螺丝孔做成3.5mm直径。如果采用公共模具要根据实际螺丝孔位置安放螺丝孔，如果采用全新设计的外壳就相对比较随意，以不影响焊接即可；

## 射频布局
本开发板采用了三种不同的无线射频模组，NB-IoT模组、WiFi模组、Sub-1G模组；
### NB-IoT模组
- NB-IoT PCB射频天线尽量放在PCB最最边缘，正反面都不能布铜，旁边也不要有大电流或密集走线；
- 模组ANT口与天线之间的线宽要保持与模组厂家提供的手册接近，尽量短距离，保持直线；
- 为达到最高射频效率，实际应用中可以找射频天线厂家定制和调试天线；

### WiFi模组
- WiFi模组处于2.4G频段，与NB-IoT模组之间干扰相对较小，保持一定距离摆放都没有太大问题；
- WiFi模组内置PCB天线的话，为到达最好收发质量，需要将PCB天线部分伸出母版PCB外部；
- WiFi模组贴片在PCB母版上时，母版上不能布铜；

### Sub-1G模组
- Sub-1G模组也处于2.4G频段，不能与WiFi模组处于同一个方向，保持180度背对背部署或90度部署；
- 本开发板Sub-1G模组采用插拔式外部设备，不使用时建议取下来；
